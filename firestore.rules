/**
 * @file Firebase Security Rules for Firestore.
 *
 * @Core Philosophy: This ruleset enforces a role-based access control model where only authenticated administrators can create, read, update, and delete application artifacts.
 * All users, including unauthenticated users, can read application artifacts.
 *
 * @Data Structure: Application artifact metadata is stored in the `/appArtifacts/{appArtifactId}` collection.
 *
 * @Key Security Decisions:
 *   - All authenticated users can read app artifacts.
 *   - Only authenticated admins can create, update, and delete app artifacts.
 *   - Data shape validation is relaxed for rapid prototyping. Only authorization-critical fields are validated.
 *   - The rules explicitly deny write operations for non-admin users.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages access to app artifact metadata.  Only authenticated admins can create, update, and delete artifacts.  All users can read.
     * @path /appArtifacts/{appArtifactId}
     * @allow (get, list) Allow any user to read artifact metadata.
     * @allow (create) Allow an authenticated admin to create artifact metadata.
     * @allow (update, delete) Allow an authenticated admin to update/delete artifact metadata.
     * @deny (create, update, delete) Deny create, update, or delete operations from unauthenticated users.
     * @principle Enforces role-based access control for managing app artifacts.
     */
    match /appArtifacts/{appArtifactId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    // Define helper functions here
    function isSignedIn() {
      return request.auth != null;
    }
  }
}